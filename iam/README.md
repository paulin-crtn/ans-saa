# ğŸ§™ Identity and Access Management

NO COST - GLOBAL SERVICE

- **User**: Identities which represent Humans or Applications that need access to the account (1 user = 1 entity)
- **Group**: Collection of related users (e.g. development team, finance or HR)
- **Role**: Identities that can be assumable by anyone who needs it (1 role = 1+ entities)

Policy is a document (or object) that **ALLOW** or **DENY** access to AWS services when attached to a user, group or role.

> [!IMPORTANT]
> Always give the fewest permissions necessary: **Least Privilege Principle**

- Authenticate: prove you are who you claim to be
- Authorize: allow or deny access to resources

## ğŸ‘¤ Users

- `5,000` maximum per account
- A user can be part of maximum `10` groups

## ğŸ‘¥  Groups

Just containers for users !

- `300` maximum per account (soft limit)
- No limit for number of users in a group
- Cannot log in to IAM Groups
- Groups can have policies attached to them (**Inline** or **Managed**)
- A user can be part of multiple group: he inherits the policies of all the groups he is in + his own policy
- No group with all users by default (need to be created and managed if needed)
- NO NESTING (group inside a group)

> [!IMPORTANT]
> Groups are NOT a true identity: they cannot be referenced as a `Principal` in a **Resource Policy**

## ğŸ§¢ Roles

An IAM identity that you can create in your account that has specific permissions. An IAM role has some similarities to an IAM user. Roles and users are both AWS identities with permissions policies that determine what the identity can and cannot do in AWS. However, instead of being uniquely associated with one person, **a role is intended to be assumable by anyone who needs it**. Also, a role does not have standard long-term credentials such as a password or access keys associated with it. Instead, when you assume a role, it provides you with temporary security credentials for your role session.

- Trust Policy: which identities can assume that role
- Permissions Policy: see Policies

> [!IMPORTANT]
> When we assume a role, **temporary credentials** are generated by `STS` (Secure Token Service)

### ğŸ¤” When to use IAM Roles ?

- With AWS services: Give permission to a service to do something in another service: Lambda, S3, DDB., etc.
- In emergency situation: Give extra permissions to a user in some case
- For ID Federation: Give permissions to an external identity provider (allowing external identities to assume a role) = no AWS credentials on the App (used existing customer logins) & scales great (large number of accounts) ğŸ™Œ
- For Cross-Account Access

## ğŸ”— Service-linked roles

IAM role linked to a specific AWS service.

- **PREDEFINED** by a service, providing permissions that a service needs to interact with other AWS services on your behalf
- Service might create/delete a role or allow you to during setup or within IAM
- You CANNOT delete the role until it's no longer required

To pass a role (and its permissions) to an AWS service, a user must have the `PassRole` permission to pass the role to the service. This helps administrators ensure that only approved users can configure a service with a role that grants permissions.

## ğŸ”‘ Access Keys

Application or CLI long term credentials to log in an AWS account, composed of an `Access Key ID` and a `Secret Access Key`.

- An IAM user only has 1 username and 1 password but can have multiple access keys
- Access keys can be created, deleted, made active or inactive
- After creation, AWS won't show again the `Secret Access Key` (store it in a safe place)

## ğŸ“ Policies

**DENY** always overrule **ALLOW**: `Explicit DENY` > `Explicit Allow` > `IMPLICIT DENY` (default, no statement)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "GetObjectAndVersion",
      "Effect": "Allow",
      "Action": ["s3:GetObject", "s3:GetObjectVersion"],
      "Resource": "arn:aws:s3:::DOC-EXAMPLE-BUCKET/*"
    }
  ]
}
```

> [!NOTE]
> If there is a `Principal` it is a Resource Policy. `Principal` represents an authenticated or unauthenticated User or Role.

- **Inline Policy**: One policy for each identity (useful for policy exception)
- **Managed Policy**: One policy assigned to multiple identities (reusable, low management overhead) - AWS Managed Policy (might not fit exact needs) and Customer Managed Policy 

## ğŸ§¬ Amazon Resource Name

Uniquely identify resources within any AWS accounts: `arn:partition:service:region:account-id:resource-type:resource-id`. Can sometimes omit a field or use a wildcard.

- `arn:aws:s3:::catgifs` - Represents the bucket (the resource)
- `arn:aws:s3:::catgifs/*` - Represents the objects (what is inside the resource)

> [!NOTE]
> ARN is used to reference a User or a Role in a **Resource Policy**

# ğŸ¥¸ Cognito

**Authentication**, **Authorization** and **user management** for web/mobile apps.

### ğŸŠâ€ User Pools 

- Sign-in and get a JSON Web Token
- User directory management and profiles, **SIGN-UP and SIGN-IN**, MFA & other security features
- Works with most application and some AWS products (mostly API Gateway)
- Allow sign-in using external identity providers (Facebook, Google, Apple...) + SAML

> [!IMPORTANT]
> Most AWS services cannot use JWT and require AWS credentials

### ğŸŠâ€ Identity Pools

- Allow to offer access to Temporary AWS Credentials: used to access AWS resource ğŸ™Œ
- Unauthenticated Identities - Guest Users
- Federated Identities: **SWAP IDENTITIES** from external identities (Facebook, Google, Apple...), SAML or User Pool for short term AWS Credentials
- Cognito assumes an IAM role defined in Identity Pool and returns temporary AWS credentials to the client
